<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>phpCAS: /CAS.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>/CAS.php</h1><a href="CAS_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 &lt;?php
00002 
00003 <span class="comment">// commented in 0.4.22-RC2 for Sylvain Derosiaux</span>
00004 <span class="comment">// error_reporting(E_ALL ^ E_NOTICE);</span>
00005 
00006 <span class="comment">//</span>
00007 <span class="comment">// hack by Vangelis Haniotakis to handle the absence of $_SERVER['REQUEST_URI'] in IIS</span>
00008 <span class="comment">//</span>
00009 <span class="keywordflow">if</span> (!$_SERVER['REQUEST_URI']) {
00010         $_SERVER['REQUEST_URI'] = $_SERVER['SCRIPT_NAME'].<span class="charliteral">'?'</span>.$_SERVER['QUERY_STRING'];
00011 }
00012 
00013 <span class="comment">//</span>
00014 <span class="comment">// another one by Vangelis Haniotakis also to make phpCAS work with PHP5</span>
00015 <span class="comment">//</span>
00016 <span class="keywordflow">if</span> (version_compare(PHP_VERSION,<span class="charliteral">'5'</span>,'&gt;=')) {
00017         require_once(dirname(__FILE__).'/domxml-php4-php5.php');
00018 }
00019 
00027 <span class="comment">// ########################################################################</span>
00028 <span class="comment">//  CONSTANTS</span>
00029 <span class="comment">// ########################################################################</span>
00030 
00031 <span class="comment">// ------------------------------------------------------------------------</span>
00032 <span class="comment">//  CAS VERSIONS</span>
00033 <span class="comment">// ------------------------------------------------------------------------</span>
00034 
<a name="l00038"></a><a class="code" href="CAS_8php.html#a1">00038</a> define('PHPCAS_VERSION<span class="charliteral">','</span>0.6.0-1');
00039 
00040 <span class="comment">// ------------------------------------------------------------------------</span>
00041 <span class="comment">//  CAS VERSIONS</span>
00042 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00051"></a><a class="code" href="group__public.html#ga1">00051</a> <span class="comment"></span>define(<span class="stringliteral">"CAS_VERSION_1_0"</span>,'1.0');
<a name="l00055"></a><a class="code" href="group__public.html#ga2">00055</a> define(<span class="stringliteral">"CAS_VERSION_2_0"</span>,'2.0');
00056 
00062 <span class="comment">// ------------------------------------------------------------------------</span>
00063 <span class="comment">//  FILE PGT STORAGE</span>
00064 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00068"></a><a class="code" href="group__publicPGTStorage.html#ga2">00068</a> <span class="comment"></span>define(<span class="stringliteral">"CAS_PGT_STORAGE_FILE_DEFAULT_PATH"</span>,'/tmp');
<a name="l00072"></a><a class="code" href="group__publicPGTStorage.html#ga3">00072</a> define(<span class="stringliteral">"CAS_PGT_STORAGE_FILE_FORMAT_PLAIN"</span>,'plain');
<a name="l00076"></a><a class="code" href="group__publicPGTStorage.html#ga4">00076</a> define(<span class="stringliteral">"CAS_PGT_STORAGE_FILE_FORMAT_XML"</span>,'xml');
<a name="l00080"></a><a class="code" href="group__publicPGTStorage.html#ga5">00080</a> define(<span class="stringliteral">"CAS_PGT_STORAGE_FILE_DEFAULT_FORMAT"</span>,CAS_PGT_STORAGE_FILE_FORMAT_PLAIN);
00081 <span class="comment">// ------------------------------------------------------------------------</span>
00082 <span class="comment">//  DATABASE PGT STORAGE</span>
00083 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00087"></a><a class="code" href="group__publicPGTStorage.html#ga6">00087</a> <span class="comment"></span>define(<span class="stringliteral">"CAS_PGT_STORAGE_DB_DEFAULT_DATABASE_TYPE"</span>,'mysql');
<a name="l00091"></a><a class="code" href="group__publicPGTStorage.html#ga7">00091</a> define(<span class="stringliteral">"CAS_PGT_STORAGE_DB_DEFAULT_HOSTNAME"</span>,'localhost');
<a name="l00095"></a><a class="code" href="group__publicPGTStorage.html#ga8">00095</a> define(<span class="stringliteral">"CAS_PGT_STORAGE_DB_DEFAULT_PORT"</span>,'');
<a name="l00099"></a><a class="code" href="group__publicPGTStorage.html#ga9">00099</a> define(<span class="stringliteral">"CAS_PGT_STORAGE_DB_DEFAULT_DATABASE"</span>,'<a class="code" href="classphpCAS.html">phpCAS</a>');
<a name="l00103"></a><a class="code" href="group__publicPGTStorage.html#ga10">00103</a> define(<span class="stringliteral">"CAS_PGT_STORAGE_DB_DEFAULT_TABLE"</span>,'pgt');
00104 
00106 <span class="comment">// ------------------------------------------------------------------------</span>
00107 <span class="comment">// SERVICE ACCESS ERRORS</span>
00108 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00117"></a><a class="code" href="group__publicServices.html#ga2">00117</a> <span class="comment"></span>define(<span class="stringliteral">"PHPCAS_SERVICE_OK"</span>,0);
<a name="l00122"></a><a class="code" href="group__publicServices.html#ga3">00122</a> define(<span class="stringliteral">"PHPCAS_SERVICE_PT_NO_SERVER_RESPONSE"</span>,1);
<a name="l00127"></a><a class="code" href="group__publicServices.html#ga4">00127</a> define(<span class="stringliteral">"PHPCAS_SERVICE_PT_BAD_SERVER_RESPONSE"</span>,2);
<a name="l00132"></a><a class="code" href="group__publicServices.html#ga5">00132</a> define(<span class="stringliteral">"PHPCAS_SERVICE_PT_FAILURE"</span>,3);
<a name="l00136"></a><a class="code" href="group__publicServices.html#ga6">00136</a> define(<span class="stringliteral">"PHPCAS_SERVICE_NOT AVAILABLE"</span>,4);
00137 
00139 <span class="comment">// ------------------------------------------------------------------------</span>
00140 <span class="comment">//  LANGUAGES</span>
00141 <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00147"></a><a class="code" href="group__publicLang.html#ga1">00147</a> <span class="comment"></span>define(<span class="stringliteral">"PHPCAS_LANG_ENGLISH"</span>,    'english');
<a name="l00148"></a><a class="code" href="group__publicLang.html#ga2">00148</a> define(<span class="stringliteral">"PHPCAS_LANG_FRENCH"</span>,     'french');
<a name="l00149"></a><a class="code" href="group__publicLang.html#ga3">00149</a> define(<span class="stringliteral">"PHPCAS_LANG_GREEK"</span>,      'greek');
<a name="l00150"></a><a class="code" href="group__publicLang.html#ga4">00150</a> define(<span class="stringliteral">"PHPCAS_LANG_GERMAN"</span>,     'german');
<a name="l00151"></a><a class="code" href="group__publicLang.html#ga5">00151</a> define(<span class="stringliteral">"PHPCAS_LANG_JAPANESE"</span>,   'japanese');
<a name="l00152"></a><a class="code" href="group__publicLang.html#ga6">00152</a> define(<span class="stringliteral">"PHPCAS_LANG_SPANISH"</span>,    'spanish');
<a name="l00153"></a><a class="code" href="group__publicLang.html#ga7">00153</a> define(<span class="stringliteral">"PHPCAS_LANG_CATALAN"</span>,    'catalan');
00154 
<a name="l00165"></a><a class="code" href="group__internalLang.html#ga5">00165</a> define(<span class="stringliteral">"PHPCAS_LANG_DEFAULT"</span>, PHPCAS_LANG_ENGLISH);
00166 
00168 <span class="comment">// ------------------------------------------------------------------------</span>
00169 <span class="comment">//  MISC</span>
00170 <span class="comment">// ------------------------------------------------------------------------</span>
00181 <span class="comment"></span><a class="code" href="group__internalMisc.html#ga0">$GLOBALS</a>['PHPCAS_CLIENT']  = null;
00182 
00189 <a class="code" href="group__internalMisc.html#ga0">$GLOBALS</a>['PHPCAS_INIT_CALL'] = array('done' =&gt; FALSE,
00190         'file' =&gt; <span class="charliteral">'?'</span>,
00191         'line' =&gt; -1,
00192         'method' =&gt; <span class="charliteral">'?'</span>);
00193 
00200 <a class="code" href="group__internalMisc.html#ga0">$GLOBALS</a>['PHPCAS_AUTH_CHECK_CALL'] = array('done' =&gt; FALSE,
00201         'file' =&gt; <span class="charliteral">'?'</span>,
00202         'line' =&gt; -1,
00203         'method' =&gt; <span class="charliteral">'?'</span>,
00204         'result' =&gt; FALSE);
00205 
<a name="l00211"></a><a class="code" href="group__internalMisc.html#ga0">00211</a> <a class="code" href="group__internalMisc.html#ga0">$GLOBALS</a>['PHPCAS_DEBUG']  = array('filename' =&gt; FALSE,
00212         'indent' =&gt; 0,
00213         'unique_id' =&gt; '');
00214 
00217 <span class="comment">// ########################################################################</span>
00218 <span class="comment">//  CLIENT CLASS</span>
00219 <span class="comment">// ########################################################################</span>
00220 
00221 <span class="comment">// include client class</span>
00222 include_once(dirname(__FILE__).'/client.php');
00223 
00224 <span class="comment">// ########################################################################</span>
00225 <span class="comment">//  INTERFACE CLASS</span>
00226 <span class="comment">// ########################################################################</span>
00227 
<a name="l00242"></a><a class="code" href="classphpCAS.html">00242</a> <span class="keyword">class </span><a class="code" href="classphpCAS.html">phpCAS</a>
00243 {
00244         
00245         <span class="comment">// ########################################################################</span>
00246         <span class="comment">//  INITIALIZATION</span>
00247         <span class="comment">// ########################################################################</span>
00248         
<a name="l00268"></a><a class="code" href="group__publicInit.html#ga0">00268</a>         function <a class="code" href="group__publicInit.html#ga0">client</a>($server_version,
00269                                         $server_hostname,
00270                                         $server_port,
00271                                         $server_uri,
00272                                         $start_session = <span class="keyword">true</span>)
00273                 {
00274                 global $PHPCAS_CLIENT, $PHPCAS_INIT_CALL;
00275                 
00276                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00277                 <span class="keywordflow">if</span> ( is_object($PHPCAS_CLIENT) ) {
00278                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>($PHPCAS_INIT_CALL['method'].'() has already been called (at '.$PHPCAS_INIT_CALL['file'].<span class="charliteral">':'</span>.$PHPCAS_INIT_CALL['line'].<span class="charliteral">')'</span>);
00279                 }
00280                 <span class="keywordflow">if</span> ( gettype($server_version) != 'string' ) {
00281                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $server_version (should be `string\<span class="charliteral">')'</span>);
00282                 }
00283                 <span class="keywordflow">if</span> ( gettype($server_hostname) != 'string' ) {
00284                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $server_hostname (should be `string\<span class="charliteral">')'</span>);
00285                 }
00286                 <span class="keywordflow">if</span> ( gettype($server_port) != 'integer' ) {
00287                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $server_port (should be `integer\<span class="charliteral">')'</span>);
00288                 }
00289                 <span class="keywordflow">if</span> ( gettype($server_uri) != 'string' ) {
00290                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $server_uri (should be `string\<span class="charliteral">')'</span>);
00291                 }
00292                 
00293                 <span class="comment">// store where the initialzer is called from</span>
00294                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00295                 $PHPCAS_INIT_CALL = array('done' =&gt; TRUE,
00296                         'file' =&gt; $dbg[0]['file'],
00297                         'line' =&gt; $dbg[0]['line'],
00298                         'method' =&gt; __CLASS__.'::'.__FUNCTION__);
00299                 
00300                 <span class="comment">// initialize the global object $PHPCAS_CLIENT</span>
00301                 $PHPCAS_CLIENT = <span class="keyword">new</span> <a class="code" href="classCASClient.html">CASClient</a>($server_version,FALSE<span class="comment">/*proxy*/</span>,$server_hostname,$server_port,$server_uri,$start_session);
00302                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
00303                 }
00304         
<a name="l00319"></a><a class="code" href="group__publicInit.html#ga1">00319</a>         function <a class="code" href="group__publicInit.html#ga1">proxy</a>($server_version,
00320                                    $server_hostname,
00321                                    $server_port,
00322                                    $server_uri,
00323                                    $start_session = <span class="keyword">true</span>)
00324                 {
00325                 global $PHPCAS_CLIENT, $PHPCAS_INIT_CALL;
00326                 
00327                 phpCAS::traceBegin();
00328                 <span class="keywordflow">if</span> ( is_object($PHPCAS_CLIENT) ) {
00329                         phpCAS::error($PHPCAS_INIT_CALL['method'].'() has already been called (at '.$PHPCAS_INIT_CALL['file'].<span class="charliteral">':'</span>.$PHPCAS_INIT_CALL['line'].<span class="charliteral">')'</span>);
00330                 }
00331                 <span class="keywordflow">if</span> ( gettype($server_version) != 'string' ) {
00332                         phpCAS::error('type mismatched <span class="keywordflow">for</span> parameter $server_version (should be `string\<span class="charliteral">')'</span>);
00333                 }
00334                 <span class="keywordflow">if</span> ( gettype($server_hostname) != 'string' ) {
00335                         phpCAS::error('type mismatched <span class="keywordflow">for</span> parameter $server_hostname (should be `string\<span class="charliteral">')'</span>);
00336                 }
00337                 <span class="keywordflow">if</span> ( gettype($server_port) != 'integer' ) {
00338                         phpCAS::error('type mismatched <span class="keywordflow">for</span> parameter $server_port (should be `integer\<span class="charliteral">')'</span>);
00339                 }
00340                 <span class="keywordflow">if</span> ( gettype($server_uri) != 'string' ) {
00341                         phpCAS::error('type mismatched <span class="keywordflow">for</span> parameter $server_uri (should be `string\<span class="charliteral">')'</span>);
00342                 }
00343                 
00344                 <span class="comment">// store where the initialzer is called from</span>
00345                 $dbg = phpCAS::backtrace();
00346                 $PHPCAS_INIT_CALL = array('done' =&gt; TRUE,
00347                         'file' =&gt; $dbg[0]['file'],
00348                         'line' =&gt; $dbg[0]['line'],
00349                         'method' =&gt; __CLASS__.'::'.__FUNCTION__);
00350                 
00351                 <span class="comment">// initialize the global object $PHPCAS_CLIENT</span>
00352                 $PHPCAS_CLIENT = <span class="keyword">new</span> <a class="code" href="classCASClient.html">CASClient</a>($server_version,TRUE<span class="comment">/*proxy*/</span>,$server_hostname,$server_port,$server_uri,$start_session);
00353                 phpCAS::traceEnd();
00354                 }
00355         
00357         <span class="comment">// ########################################################################</span>
00358         <span class="comment">//  DEBUGGING</span>
00359         <span class="comment">// ########################################################################</span>
00360         
<a name="l00371"></a><a class="code" href="group__publicDebug.html#ga0">00371</a>         function <a class="code" href="group__publicDebug.html#ga0">setDebug</a>($filename='')
00372                 {
00373                 global $PHPCAS_DEBUG;
00374                 
00375                 <span class="keywordflow">if</span> ( $filename != FALSE &amp;&amp; gettype($filename) != 'string' ) {
00376                         phpCAS::error('type mismatched <span class="keywordflow">for</span> parameter $dbg (should be FALSE or the name of the log file)');
00377                 }
00378                 
00379                 <span class="keywordflow">if</span> ( empty($filename) ) {
00380                         <span class="keywordflow">if</span> ( preg_match('/^Win.*/',getenv('OS')) ) {
00381                                 <span class="keywordflow">if</span> ( isset($_ENV['TMP']) ) {
00382                                         $debugDir = $_ENV['TMP'].<span class="charliteral">'/'</span>;
00383                                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset($_ENV['TEMP']) ) {
00384                                         $debugDir = $_ENV['TEMP'].<span class="charliteral">'/'</span>;
00385                                 } <span class="keywordflow">else</span> {
00386                                         $debugDir = '';
00387                                 }
00388                         } <span class="keywordflow">else</span> {
00389                                 $debugDir = '/tmp/';
00390                         }
00391                         $filename = $debugDir . '<a class="code" href="classphpCAS.html">phpCAS</a>.log';
00392                 }
00393                 
00394                 <span class="keywordflow">if</span> ( empty($PHPCAS_DEBUG['unique_id']) ) {
00395                         $PHPCAS_DEBUG['unique_id'] = substr(strtoupper(md5(uniqid(''))),0,4);
00396                 }
00397                 
00398                 $PHPCAS_DEBUG['filename'] = $filename;
00399                 
00400                 <a class="code" href="group__internalDebug.html#ga3">phpCAS::trace</a>('START ******************');
00401                 }
00402         
<a name="l00413"></a><a class="code" href="group__internalDebug.html#ga0">00413</a>         function <a class="code" href="group__internalDebug.html#ga0">backtrace</a>()
00414                 {
00415                 <span class="keywordflow">if</span> ( function_exists('debug_backtrace') ) {
00416                         <span class="keywordflow">return</span> debug_backtrace();
00417                 } <span class="keywordflow">else</span> {
00418                         <span class="comment">// poor man's hack ... but it does work ...</span>
00419                         <span class="keywordflow">return</span> array();
00420                 }
00421                 }
00422         
<a name="l00430"></a><a class="code" href="group__internalDebug.html#ga1">00430</a>         function <a class="code" href="group__internalDebug.html#ga1">log</a>($str)
00431                 {
00432                 $indent_str = <span class="stringliteral">"."</span>;
00433                 global $PHPCAS_DEBUG;
00434                 
00435                 <span class="keywordflow">if</span> ( $PHPCAS_DEBUG['filename'] ) {
00436                         <span class="keywordflow">for</span> ($i=0;$i&lt;$PHPCAS_DEBUG['indent'];$i++) {
00437                                 $indent_str .= '|    ';
00438                         }
00439                         error_log($PHPCAS_DEBUG['unique_id'].<span class="charliteral">' '</span>.$indent_str.$str.<span class="stringliteral">"\n"</span>,3,$PHPCAS_DEBUG['filename']);
00440                 }
00441                 
00442                 }
00443         
<a name="l00452"></a><a class="code" href="group__internalDebug.html#ga2">00452</a>         function <a class="code" href="group__internalDebug.html#ga2">error</a>($msg)
00453                 {
00454                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00455                 $function = <span class="charliteral">'?'</span>;
00456                 $file = <span class="charliteral">'?'</span>;
00457                 $line = <span class="charliteral">'?'</span>;
00458                 <span class="keywordflow">if</span> ( is_array($dbg) ) {
00459                         <span class="keywordflow">for</span> ( $i=1; $i&lt;<span class="keyword">sizeof</span>($dbg); $i++) {
00460                                 <span class="keywordflow">if</span> ( is_array($dbg[$i]) ) {
00461                                         <span class="keywordflow">if</span> ( $dbg[$i]['<span class="keyword">class</span>'] == __CLASS__ ) {
00462                                                 $function = $dbg[$i]['function'];
00463                                                 $file = $dbg[$i]['file'];
00464                                                 $line = $dbg[$i]['line'];
00465                                         }
00466                                 }
00467                         }
00468                 }
00469                 echo <span class="stringliteral">"&lt;br /&gt;\n&lt;b&gt;phpCAS error&lt;/b&gt;: &lt;font color=\"FF0000\"&gt;&lt;b&gt;"</span>.__CLASS__.<span class="stringliteral">"::"</span>.$function.'(): '.htmlentities($msg).<span class="stringliteral">"&lt;/b&gt;&lt;/font&gt; in &lt;b&gt;"</span>.$file.<span class="stringliteral">"&lt;/b&gt; on line &lt;b&gt;"</span>.$line.<span class="stringliteral">"&lt;/b&gt;&lt;br /&gt;\n"</span>;
00470                 <a class="code" href="group__internalDebug.html#ga3">phpCAS::trace</a>($msg);
00471                 <a class="code" href="group__internalDebug.html#ga6">phpCAS::traceExit</a>();
00472                 exit();
00473                 }
00474         
<a name="l00478"></a><a class="code" href="group__internalDebug.html#ga3">00478</a>         function <a class="code" href="group__internalDebug.html#ga3">trace</a>($str)
00479                 {
00480                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00481                 <a class="code" href="group__internalDebug.html#ga1">phpCAS::log</a>($str.' ['.basename($dbg[1]['file']).<span class="charliteral">':'</span>.$dbg[1]['line'].<span class="charliteral">']'</span>);
00482                 }
00483         
<a name="l00487"></a><a class="code" href="group__internalDebug.html#ga4">00487</a>         function <a class="code" href="group__internalDebug.html#ga4">traceBegin</a>()
00488                 {
00489                 global $PHPCAS_DEBUG;
00490                 
00491                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00492                 $str = '=&gt; ';
00493                 <span class="keywordflow">if</span> ( !empty($dbg[2]['<span class="keyword">class</span>']) ) {
00494                         $str .= $dbg[2]['<span class="keyword">class</span>'].'::';
00495                 }
00496                 $str .= $dbg[2]['function'].<span class="charliteral">'('</span>;      
00497                 <span class="keywordflow">if</span> ( is_array($dbg[2]['args']) ) {
00498                         foreach ($dbg[2]['args'] as $index =&gt; $arg) {
00499                                 <span class="keywordflow">if</span> ( $index != 0 ) {
00500                                         $str .= ', ';
00501                                 }
00502                                 $str .= str_replace(<span class="stringliteral">"\n"</span>,<span class="stringliteral">""</span>,var_export($arg,TRUE));
00503                         }
00504                 }
00505                 $str .= ') ['.basename($dbg[2]['file']).<span class="charliteral">':'</span>.$dbg[2]['line'].<span class="charliteral">']'</span>;
00506                 <a class="code" href="group__internalDebug.html#ga1">phpCAS::log</a>($str);
00507                 $PHPCAS_DEBUG['indent'] ++;
00508                 }
00509         
<a name="l00515"></a><a class="code" href="group__internalDebug.html#ga5">00515</a>         function <a class="code" href="group__internalDebug.html#ga5">traceEnd</a>($res='')
00516                 {
00517                 global $PHPCAS_DEBUG;
00518                 
00519                 $PHPCAS_DEBUG['indent'] --;
00520                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00521                 $str = '';
00522                 $str .= '&lt;= '.str_replace(<span class="stringliteral">"\n"</span>,<span class="stringliteral">""</span>,var_export($res,TRUE));
00523                 <a class="code" href="group__internalDebug.html#ga1">phpCAS::log</a>($str);
00524                 }
00525         
<a name="l00529"></a><a class="code" href="group__internalDebug.html#ga6">00529</a>         function <a class="code" href="group__internalDebug.html#ga6">traceExit</a>()
00530                 {
00531                 global $PHPCAS_DEBUG;
00532                 
00533                 <a class="code" href="group__internalDebug.html#ga1">phpCAS::log</a>('exit()');
00534                 <span class="keywordflow">while</span> ( $PHPCAS_DEBUG['indent'] &gt; 0 ) {
00535                         <a class="code" href="group__internalDebug.html#ga1">phpCAS::log</a>(<span class="charliteral">'-'</span>);
00536                         $PHPCAS_DEBUG['indent'] --;
00537                 }
00538                 }
00539         
00541         <span class="comment">// ########################################################################</span>
00542         <span class="comment">//  INTERNATIONALIZATION</span>
00543         <span class="comment">// ########################################################################</span>
<a name="l00557"></a><a class="code" href="group__publicLang.html#ga0">00557</a> <span class="comment"></span>        function <a class="code" href="group__publicLang.html#ga0">setLang</a>($lang)
00558                 {
00559                 global $PHPCAS_CLIENT;
00560                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00561                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00562                 }
00563                 <span class="keywordflow">if</span> ( gettype($lang) != 'string' ) {
00564                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $lang (should be `string\<span class="charliteral">')'</span>);
00565                 }
00566                 $PHPCAS_CLIENT-&gt;setLang($lang);
00567                 }
00568         
00570         <span class="comment">// ########################################################################</span>
00571         <span class="comment">//  VERSION</span>
00572         <span class="comment">// ########################################################################</span>
<a name="l00583"></a><a class="code" href="group__public.html#ga0">00583</a> <span class="comment"></span>        function <a class="code" href="group__public.html#ga0">getVersion</a>()
00584                 {
00585                 <span class="keywordflow">return</span> <a class="code" href="CAS_8php.html#a1">PHPCAS_VERSION</a>;
00586                 }
00587         
00589         <span class="comment">// ########################################################################</span>
00590         <span class="comment">//  HTML OUTPUT</span>
00591         <span class="comment">// ########################################################################</span>
<a name="l00602"></a><a class="code" href="group__publicOutput.html#ga0">00602</a> <span class="comment"></span>        function <a class="code" href="group__publicOutput.html#ga0">setHTMLHeader</a>($header)
00603                 {
00604                 global $PHPCAS_CLIENT;
00605                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00606                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00607                 }
00608                 <span class="keywordflow">if</span> ( gettype($header) != 'string' ) {
00609                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $header (should be `string\<span class="charliteral">')'</span>);
00610                 }
00611                 $PHPCAS_CLIENT-&gt;setHTMLHeader($header);
00612                 }
00613         
<a name="l00619"></a><a class="code" href="group__publicOutput.html#ga1">00619</a>         function <a class="code" href="group__publicOutput.html#ga1">setHTMLFooter</a>($footer)
00620                 {
00621                 global $PHPCAS_CLIENT;
00622                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00623                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00624                 }
00625                 <span class="keywordflow">if</span> ( gettype($footer) != 'string' ) {
00626                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $footer (should be `string\<span class="charliteral">')'</span>);
00627                 }
00628                 $PHPCAS_CLIENT-&gt;setHTMLFooter($footer);
00629                 }
00630         
00632         <span class="comment">// ########################################################################</span>
00633         <span class="comment">//  PGT STORAGE</span>
00634         <span class="comment">// ########################################################################</span>
<a name="l00647"></a><a class="code" href="group__publicPGTStorage.html#ga0">00647</a> <span class="comment"></span>        function <a class="code" href="group__publicPGTStorage.html#ga0">setPGTStorageFile</a>($format='',
00648                 $path='')
00649                 {
00650                 global $PHPCAS_CLIENT,$PHPCAS_AUTH_CHECK_CALL;
00651                 
00652                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00653                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00654                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00655                 }
00656                 <span class="keywordflow">if</span> ( !$PHPCAS_CLIENT-&gt;isProxy() ) {
00657                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00658                 }
00659                 <span class="keywordflow">if</span> ( $PHPCAS_AUTH_CHECK_CALL['done'] ) {
00660                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called before '.$PHPCAS_AUTH_CHECK_CALL['method'].'() (called at '.$PHPCAS_AUTH_CHECK_CALL['file'].<span class="charliteral">':'</span>.$PHPCAS_AUTH_CHECK_CALL['line'].<span class="charliteral">')'</span>);
00661                 }
00662                 <span class="keywordflow">if</span> ( gettype($format) != 'string' ) {
00663                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $format (should be `string\<span class="charliteral">')'</span>);
00664                 }
00665                 <span class="keywordflow">if</span> ( gettype($path) != 'string' ) {
00666                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $format (should be `string\<span class="charliteral">')'</span>);
00667                 }
00668                 $PHPCAS_CLIENT-&gt;setPGTStorageFile($format,$path);
00669                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
00670                 }
00671         
<a name="l00687"></a><a class="code" href="group__publicPGTStorage.html#ga1">00687</a>         function <a class="code" href="group__publicPGTStorage.html#ga1">setPGTStorageDB</a>($user,
00688                                                          $password,
00689                                                          $database_type='',
00690                                                                  $hostname='',
00691                                                                          $port=0,
00692                                                                                  $database='',
00693                                                                                          $table='')
00694                 {
00695                 global $PHPCAS_CLIENT,$PHPCAS_AUTH_CHECK_CALL;
00696                 
00697                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00698                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00699                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00700                 }
00701                 <span class="keywordflow">if</span> ( !$PHPCAS_CLIENT-&gt;isProxy() ) {
00702                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00703                 }
00704                 <span class="keywordflow">if</span> ( $PHPCAS_AUTH_CHECK_CALL['done'] ) {
00705                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called before '.$PHPCAS_AUTH_CHECK_CALL['method'].'() (called at '.$PHPCAS_AUTH_CHECK_CALL['file'].<span class="charliteral">':'</span>.$PHPCAS_AUTH_CHECK_CALL['line'].<span class="charliteral">')'</span>);
00706                 }
00707                 <span class="keywordflow">if</span> ( gettype($user) != 'string' ) {
00708                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $user (should be `string\<span class="charliteral">')'</span>);
00709                 }
00710                 <span class="keywordflow">if</span> ( gettype($password) != 'string' ) {
00711                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $password (should be `string\<span class="charliteral">')'</span>);
00712                 }
00713                 <span class="keywordflow">if</span> ( gettype($database_type) != 'string' ) {
00714                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $database_type (should be `string\<span class="charliteral">')'</span>);
00715                 }
00716                 <span class="keywordflow">if</span> ( gettype($hostname) != 'string' ) {
00717                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $hostname (should be `string\<span class="charliteral">')'</span>);
00718                 }
00719                 <span class="keywordflow">if</span> ( gettype($port) != 'integer' ) {
00720                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $port (should be `integer\<span class="charliteral">')'</span>);
00721                 }
00722                 <span class="keywordflow">if</span> ( gettype($database) != 'string' ) {
00723                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $database (should be `string\<span class="charliteral">')'</span>);
00724                 }
00725                 <span class="keywordflow">if</span> ( gettype($table) != 'string' ) {
00726                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $table (should be `string\<span class="charliteral">')'</span>);
00727                 }
00728                 $PHPCAS_CLIENT-&gt;setPGTStorageDB($<span class="keyword">this</span>,$user,$password,$hostname,$port,$database,$table);
00729                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
00730                 }
00731         
00733         <span class="comment">// ########################################################################</span>
00734         <span class="comment">// ACCESS TO EXTERNAL SERVICES</span>
00735         <span class="comment">// ########################################################################</span>
<a name="l00754"></a><a class="code" href="group__publicServices.html#ga0">00754</a> <span class="comment"></span>        function <a class="code" href="group__publicServices.html#ga0">serviceWeb</a>($url,&amp;$err_code,&amp;$output)
00755                 {
00756                 global $PHPCAS_CLIENT, $PHPCAS_AUTH_CHECK_CALL;
00757                 
00758                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00759                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00760                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00761                 }
00762                 <span class="keywordflow">if</span> ( !$PHPCAS_CLIENT-&gt;isProxy() ) {
00763                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00764                 }
00765                 <span class="keywordflow">if</span> ( !$PHPCAS_AUTH_CHECK_CALL['done'] ) {
00766                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after the programmer is sure the user has been authenticated (by calling '.__CLASS__.'::<a class="code" href="group__publicAuth.html#ga1">checkAuthentication</a>() or '.__CLASS__.'::<a class="code" href="group__publicAuth.html#ga2">forceAuthentication</a>()');
00767                 }
00768                 <span class="keywordflow">if</span> ( !$PHPCAS_AUTH_CHECK_CALL['result'] ) {
00769                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('authentication was checked (by '.$PHPCAS_AUTH_CHECK_CALL['method'].'() at '.$PHPCAS_AUTH_CHECK_CALL['file'].<span class="charliteral">':'</span>.$PHPCAS_AUTH_CHECK_CALL['line'].') but the method returned FALSE');
00770                 }
00771                 <span class="keywordflow">if</span> ( gettype($url) != 'string' ) {
00772                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $url (should be `string\<span class="charliteral">')'</span>);
00773                 }
00774                 
00775                 $res = $PHPCAS_CLIENT-&gt;serviceWeb($url,$err_code,$output);
00776                 
00777                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>($res);
00778                 <span class="keywordflow">return</span> $res;
00779                 }
00780         
<a name="l00797"></a><a class="code" href="group__publicServices.html#ga1">00797</a>         function <a class="code" href="group__publicServices.html#ga1">serviceMail</a>($url,$flags,&amp;$err_code,&amp;$err_msg,&amp;$pt)
00798                 {
00799                 global $PHPCAS_CLIENT, $PHPCAS_AUTH_CHECK_CALL;
00800                 
00801                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00802                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00803                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00804                 }
00805                 <span class="keywordflow">if</span> ( !$PHPCAS_CLIENT-&gt;isProxy() ) {
00806                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00807                 }
00808                 <span class="keywordflow">if</span> ( !$PHPCAS_AUTH_CHECK_CALL['done'] ) {
00809                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after the programmer is sure the user has been authenticated (by calling '.__CLASS__.'::<a class="code" href="group__publicAuth.html#ga1">checkAuthentication</a>() or '.__CLASS__.'::<a class="code" href="group__publicAuth.html#ga2">forceAuthentication</a>()');
00810                 }
00811                 <span class="keywordflow">if</span> ( !$PHPCAS_AUTH_CHECK_CALL['result'] ) {
00812                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('authentication was checked (by '.$PHPCAS_AUTH_CHECK_CALL['method'].'() at '.$PHPCAS_AUTH_CHECK_CALL['file'].<span class="charliteral">':'</span>.$PHPCAS_AUTH_CHECK_CALL['line'].') but the method returned FALSE');
00813                 }
00814                 <span class="keywordflow">if</span> ( gettype($url) != 'string' ) {
00815                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $url (should be `string\<span class="charliteral">')'</span>);
00816                 }
00817                 
00818                 <span class="keywordflow">if</span> ( gettype($flags) != 'integer' ) {
00819                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $flags (should be `integer\<span class="charliteral">')'</span>);
00820                 }
00821                 
00822                 $res = $PHPCAS_CLIENT-&gt;serviceMail($url,$flags,$err_code,$err_msg,$pt);
00823                 
00824                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>($res);
00825                 <span class="keywordflow">return</span> $res;
00826                 }
00827         
00829         <span class="comment">// ########################################################################</span>
00830         <span class="comment">//  AUTHENTICATION</span>
00831         <span class="comment">// ########################################################################</span>
<a name="l00845"></a><a class="code" href="group__publicAuth.html#ga0">00845</a> <span class="comment"></span>        function <a class="code" href="group__publicAuth.html#ga0">setCacheTimesForAuthRecheck</a>($n)
00846                 {
00847                 global $PHPCAS_CLIENT;
00848                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00849                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00850                 }
00851                 <span class="keywordflow">if</span> ( gettype($n) != 'integer' ) {
00852                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $header (should be `string\<span class="charliteral">')'</span>);
00853                 }
00854                 $PHPCAS_CLIENT-&gt;setCacheTimesForAuthRecheck($n);
00855                 }
00856         
<a name="l00861"></a><a class="code" href="group__publicAuth.html#ga1">00861</a>         function <a class="code" href="group__publicAuth.html#ga1">checkAuthentication</a>()
00862                 {
00863                 global $PHPCAS_CLIENT, $PHPCAS_AUTH_CHECK_CALL;
00864                 
00865                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00866                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00867                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00868                 }
00869                 
00870                 $auth = $PHPCAS_CLIENT-&gt;checkAuthentication();
00871                 
00872                 <span class="comment">// store where the authentication has been checked and the result</span>
00873                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00874                 $PHPCAS_AUTH_CHECK_CALL = array('done' =&gt; TRUE,
00875                         'file' =&gt; $dbg[0]['file'],
00876                         'line' =&gt; $dbg[0]['line'],
00877                         'method' =&gt; __CLASS__.'::'.__FUNCTION__,
00878                         'result' =&gt; $auth );
00879                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>($auth);
00880                 <span class="keywordflow">return</span> $auth; 
00881                 }
00882         
<a name="l00888"></a><a class="code" href="group__publicAuth.html#ga2">00888</a>         function <a class="code" href="group__publicAuth.html#ga2">forceAuthentication</a>()
00889                 {
00890                 global $PHPCAS_CLIENT, $PHPCAS_AUTH_CHECK_CALL;
00891                 
00892                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00893                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00894                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00895                 }
00896                 
00897                 $auth = $PHPCAS_CLIENT-&gt;forceAuthentication();
00898                 
00899                 <span class="comment">// store where the authentication has been checked and the result</span>
00900                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00901                 $PHPCAS_AUTH_CHECK_CALL = array('done' =&gt; TRUE,
00902                         'file' =&gt; $dbg[0]['file'],
00903                         'line' =&gt; $dbg[0]['line'],
00904                         'method' =&gt; __CLASS__.'::'.__FUNCTION__,
00905                         'result' =&gt; $auth );
00906                 
00907                 <span class="keywordflow">if</span> ( !$auth ) {
00908                         <a class="code" href="group__internalDebug.html#ga3">phpCAS::trace</a>('user is not authenticated, redirecting to the CAS server');
00909                         $PHPCAS_CLIENT-&gt;forceAuthentication();
00910                 } <span class="keywordflow">else</span> {
00911                         <a class="code" href="group__internalDebug.html#ga3">phpCAS::trace</a>('no need to <a class="code" href="group__publicAuth.html#ga4">authenticate</a> (user `'.<a class="code" href="group__publicAuth.html#ga7">phpCAS::getUser</a>().<span class="charliteral">'\'</span> is already authenticated)');
00912                 }
00913                 
00914                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
00915                 <span class="keywordflow">return</span> $auth; 
00916                 }
00917         
<a name="l00921"></a><a class="code" href="group__publicAuth.html#ga3">00921</a>         function <a class="code" href="group__publicAuth.html#ga3">renewAuthentication</a>() {
00922                 global $PHPCAS_CLIENT, $PHPCAS_AUTH_CHECK_CALL;
00923                 
00924                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00925                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00926                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before'.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00927                 }
00928                 
00929                 <span class="comment">// store where the authentication has been checked and the result</span>
00930                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00931                 $PHPCAS_AUTH_CHECK_CALL = array('done' =&gt; TRUE, 'file' =&gt; $dbg[0]['file'], 'line' =&gt; $dbg[0]['line'], 'method' =&gt; __CLASS__.'::'.__FUNCTION__, 'result' =&gt; $auth );
00932                 
00933                 $PHPCAS_CLIENT-&gt;renewAuthentication();
00934                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
00935         }
00936 
<a name="l00940"></a><a class="code" href="group__publicAuth.html#ga4">00940</a>         function <a class="code" href="group__publicAuth.html#ga4">authenticate</a>()
00941                 {
00942                 <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method is deprecated. You should use '.__CLASS__.'::forceAuthentication() instead');
00943                 }
00944         
<a name="l00951"></a><a class="code" href="group__publicAuth.html#ga5">00951</a>         function <a class="code" href="group__publicAuth.html#ga5">isAuthenticated</a>()
00952                 {
00953                 global $PHPCAS_CLIENT, $PHPCAS_AUTH_CHECK_CALL;
00954                 
00955                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00956                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00957                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00958                 }
00959                 
00960                 <span class="comment">// call the isAuthenticated method of the global $PHPCAS_CLIENT object</span>
00961                 $auth = $PHPCAS_CLIENT-&gt;isAuthenticated();
00962                 
00963                 <span class="comment">// store where the authentication has been checked and the result</span>
00964                 $dbg = <a class="code" href="group__internalDebug.html#ga0">phpCAS::backtrace</a>();
00965                 $PHPCAS_AUTH_CHECK_CALL = array('done' =&gt; TRUE,
00966                         'file' =&gt; $dbg[0]['file'],
00967                         'line' =&gt; $dbg[0]['line'],
00968                         'method' =&gt; __CLASS__.'::'.__FUNCTION__,
00969                         'result' =&gt; $auth );
00970                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>($auth);
00971                 <span class="keywordflow">return</span> $auth;
00972                 }
00973         
<a name="l00980"></a><a class="code" href="group__publicAuth.html#ga6">00980</a>         function <a class="code" href="group__publicAuth.html#ga6">isSessionAuthenticated</a> ()
00981                 {
00982                 global $PHPCAS_CLIENT;
00983                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
00984                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
00985                 }
00986                 <span class="keywordflow">return</span>($PHPCAS_CLIENT-&gt;isSessionAuthenticated());
00987                 }
00988         
<a name="l00996"></a><a class="code" href="group__publicAuth.html#ga7">00996</a>         function <a class="code" href="group__publicAuth.html#ga7">getUser</a>()
00997                 {
00998                 global $PHPCAS_CLIENT, $PHPCAS_AUTH_CHECK_CALL;
00999                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01000                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01001                 }
01002                 <span class="keywordflow">if</span> ( !$PHPCAS_AUTH_CHECK_CALL['done'] ) {
01003                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::forceAuthentication() or '.__CLASS__.'::isAuthenticated()');
01004                 }
01005                 <span class="keywordflow">if</span> ( !$PHPCAS_AUTH_CHECK_CALL['result'] ) {
01006                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('authentication was checked (by '.$PHPCAS_AUTH_CHECK_CALL['method'].'() at '.$PHPCAS_AUTH_CHECK_CALL['file'].<span class="charliteral">':'</span>.$PHPCAS_AUTH_CHECK_CALL['line'].') but the method returned FALSE');
01007                 }
01008                 <span class="keywordflow">return</span> $PHPCAS_CLIENT-&gt;getUser();
01009                 }
01010         
<a name="l01017"></a><a class="code" href="group__publicAuth.html#ga8">01017</a>         function <a class="code" href="group__publicAuth.html#ga8">getServerLoginURL</a>()
01018                 {
01019                 global $PHPCAS_CLIENT;
01020                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01021                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01022                 }
01023                 <span class="keywordflow">return</span> $PHPCAS_CLIENT-&gt;getServerLoginURL();
01024                 }
01025         
<a name="l01031"></a><a class="code" href="group__publicAuth.html#ga9">01031</a>         function <a class="code" href="group__publicAuth.html#ga9">setServerLoginURL</a>($url='')
01032                 {
01033                 global $PHPCAS_CLIENT;
01034                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
01035                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01036                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after
01037                                 '.__CLASS__.'::client()');
01038                 }
01039                 <span class="keywordflow">if</span> ( gettype($url) != 'string' ) {
01040                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $url (should be
01041                         `string\<span class="charliteral">')'</span>);
01042                 }
01043                 $PHPCAS_CLIENT-&gt;setServerLoginURL($url);
01044                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
01045                 }
01046         
<a name="l01053"></a><a class="code" href="group__publicAuth.html#ga10">01053</a>         function <a class="code" href="group__publicAuth.html#ga10">getServerLogoutURL</a>()
01054                 {
01055                 global $PHPCAS_CLIENT;
01056                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01057                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should not be called before '.__CLASS__.'::client() or '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01058                 }
01059                 <span class="keywordflow">return</span> $PHPCAS_CLIENT-&gt;getServerLogoutURL();
01060                 }
01061         
<a name="l01067"></a><a class="code" href="group__publicAuth.html#ga11">01067</a>         function <a class="code" href="group__publicAuth.html#ga11">setServerLogoutURL</a>($url='')
01068                 {
01069                 global $PHPCAS_CLIENT;
01070                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
01071                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01072                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after
01073                                 '.__CLASS__.'::client()');
01074                 }
01075                 <span class="keywordflow">if</span> ( gettype($url) != 'string' ) {
01076                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $url (should be
01077                         `string\<span class="charliteral">')'</span>);
01078                 }
01079                 $PHPCAS_CLIENT-&gt;setServerLogoutURL($url);
01080                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
01081                 }
01082         
<a name="l01087"></a><a class="code" href="group__publicAuth.html#ga12">01087</a>         function <a class="code" href="group__publicAuth.html#ga12">logout</a>($url = <span class="stringliteral">""</span>)
01088                 {
01089                 global $PHPCAS_CLIENT;
01090                 
01091                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
01092                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01093                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::client() or'.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01094                 }
01095                 $PHPCAS_CLIENT-&gt;logout($url);
01096                 <span class="comment">// never reached</span>
01097                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
01098                 }
01099         
<a name="l01106"></a><a class="code" href="group__publicAuth.html#ga13">01106</a>         function <a class="code" href="group__publicAuth.html#ga13">setFixedCallbackURL</a>($url='')
01107                 {
01108                 global $PHPCAS_CLIENT;
01109                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
01110                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01111                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01112                 }
01113                 <span class="keywordflow">if</span> ( !$PHPCAS_CLIENT-&gt;isProxy() ) {
01114                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01115                 }
01116                 <span class="keywordflow">if</span> ( gettype($url) != 'string' ) {
01117                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $url (should be `string\<span class="charliteral">')'</span>);
01118                 }
01119                 $PHPCAS_CLIENT-&gt;setCallbackURL($url);
01120                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
01121                 }
01122         
<a name="l01129"></a><a class="code" href="group__publicAuth.html#ga14">01129</a>         function <a class="code" href="group__publicAuth.html#ga14">setFixedServiceURL</a>($url)
01130                 {
01131                 global $PHPCAS_CLIENT;
01132                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
01133                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01134                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01135                 }  
01136                 <span class="keywordflow">if</span> ( gettype($url) != 'string' ) {
01137                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $url (should be `string\<span class="charliteral">')'</span>);
01138                 }
01139                 $PHPCAS_CLIENT-&gt;setURL($url);
01140                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
01141                 }
01142         
<a name="l01146"></a><a class="code" href="group__publicAuth.html#ga15">01146</a>         function <a class="code" href="group__publicAuth.html#ga15">getServiceURL</a>()
01147                 {
01148                 global $PHPCAS_CLIENT;
01149                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01150                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01151                 }  
01152                 <span class="keywordflow">return</span>($PHPCAS_CLIENT-&gt;getURL());
01153                 }
01154         
<a name="l01158"></a><a class="code" href="group__publicAuth.html#ga16">01158</a>         function <a class="code" href="group__publicAuth.html#ga16">retrievePT</a>($target_service,&amp;$err_code,&amp;$err_msg)
01159                 {
01160                 global $PHPCAS_CLIENT;
01161                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01162                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01163                 }  
01164                 <span class="keywordflow">if</span> ( gettype($target_service) != 'string' ) {
01165                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $target_service(should be `string\<span class="charliteral">')'</span>);
01166                 }
01167                 <span class="keywordflow">return</span>($PHPCAS_CLIENT-&gt;retrievePT($target_service,$err_code,$err_msg));
01168                 }
01169         
<a name="l01175"></a><a class="code" href="group__publicAuth.html#ga17">01175</a>         function <a class="code" href="group__publicAuth.html#ga17">setCasServerCert</a>($cert)
01176                 {
01177                 global $PHPCAS_CLIENT;
01178                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
01179                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01180                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::client() or'.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01181                 }  
01182                 <span class="keywordflow">if</span> ( gettype($cert) != 'string' ) {
01183                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $cert (should be `string\<span class="charliteral">')'</span>);
01184                 }
01185                 $PHPCAS_CLIENT-&gt;setCasServerCert($cert);
01186                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
01187                 }
01188         
<a name="l01194"></a><a class="code" href="group__publicAuth.html#ga18">01194</a>         function <a class="code" href="group__publicAuth.html#ga18">setCasServerCACert</a>($cert)
01195                 {
01196                 global $PHPCAS_CLIENT;
01197                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
01198                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01199                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::client() or'.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01200                 }  
01201                 <span class="keywordflow">if</span> ( gettype($cert) != 'string' ) {
01202                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('type mismatched <span class="keywordflow">for</span> parameter $cert (should be `string\<span class="charliteral">')'</span>);
01203                 }
01204                 $PHPCAS_CLIENT-&gt;setCasServerCACert($cert);
01205                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
01206                 }
01207         
<a name="l01211"></a><a class="code" href="group__publicAuth.html#ga19">01211</a>         function <a class="code" href="group__publicAuth.html#ga19">setNoCasServerValidation</a>()
01212                 {
01213                 global $PHPCAS_CLIENT;
01214                 <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
01215                 <span class="keywordflow">if</span> ( !is_object($PHPCAS_CLIENT) ) {
01216                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('<span class="keyword">this</span> method should only be called after '.__CLASS__.'::client() or'.__CLASS__.'::<a class="code" href="group__publicInit.html#ga1">proxy</a>()');
01217                 }  
01218                 $PHPCAS_CLIENT-&gt;setNoCasServerValidation();
01219                 <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();
01220                 }
01221         
01224 }
01225 
01226 <span class="comment">// ########################################################################</span>
01227 <span class="comment">// DOCUMENTATION</span>
01228 <span class="comment">// ########################################################################</span>
01229 
01230 <span class="comment">// ########################################################################</span>
01231 <span class="comment">//  MAIN PAGE</span>
01232 
01240 <span class="comment">// ########################################################################</span>
01241 <span class="comment">//  MODULES DEFINITION</span>
01242 
01317 <span class="comment">// ########################################################################</span>
01318 <span class="comment">//  EXAMPLES</span>
01319 
01356 ?&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri May 2 11:03:57 2008 for phpCAS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
