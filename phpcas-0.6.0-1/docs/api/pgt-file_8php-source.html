<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>phpCAS: /PGTStorage/pgt-file.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>/PGTStorage/pgt-file.php</h1><a href="pgt-file_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 &lt;?php
00002 
<a name="l00018"></a><a class="code" href="classPGTStorageFile.html">00018</a> <span class="keyword">class </span><a class="code" href="classPGTStorageFile.html">PGTStorageFile</a> <span class="keyword">extends</span> <a class="code" href="classPGTStorage.html">PGTStorage</a>
00019 {
<a name="l00031"></a><a class="code" href="group__internalPGTStorageFile.html#ga0">00031</a>   var <a class="code" href="group__internalPGTStorageFile.html#ga0">$_path</a>;
00032 
<a name="l00041"></a><a class="code" href="group__internalPGTStorageFile.html#ga2">00041</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga2">getPath</a>()
00042     {
00043       <span class="keywordflow">return</span> $this-&gt;_path;
00044     }
00045 
<a name="l00052"></a><a class="code" href="group__internalPGTStorageFile.html#ga1">00052</a>   var <a class="code" href="group__internalPGTStorageFile.html#ga1">$_format</a>;
00053 
<a name="l00061"></a><a class="code" href="group__internalPGTStorageFile.html#ga3">00061</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga3">getFormat</a>()
00062     {
00063       <span class="keywordflow">return</span> $this-&gt;_format;
00064     }
00065 
00066   <span class="comment">// ########################################################################</span>
00067   <span class="comment">//  DEBUGGING</span>
00068   <span class="comment">// ########################################################################</span>
00069   
<a name="l00077"></a><a class="code" href="group__internalPGTStorageFile.html#ga4">00077</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga4">getStorageType</a>()
00078     {
00079       <span class="keywordflow">return</span> <span class="stringliteral">"file"</span>;
00080     }
00081 
<a name="l00089"></a><a class="code" href="group__internalPGTStorageFile.html#ga5">00089</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga5">getStorageInfo</a>()
00090     {
00091       <span class="keywordflow">return</span> 'path=`'.$this-&gt;getPath().<span class="charliteral">'\'</span>, format=`'.$this-&gt;getFormat().<span class="charliteral">'\''</span>;
00092     }
00093 
00094   <span class="comment">// ########################################################################</span>
00095   <span class="comment">//  CONSTRUCTOR</span>
00096   <span class="comment">// ########################################################################</span>
00097   
<a name="l00107"></a><a class="code" href="group__internalPGTStorageFile.html#ga6">00107</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga6">PGTStorageFile</a>($cas_parent,$format,$path)
00108     {
00109       <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00110       <span class="comment">// call the ancestor's constructor</span>
00111       $this-&gt;<a class="code" href="group__internalPGTStorage.html#ga13">PGTStorage</a>($cas_parent);
00112 
00113       <span class="keywordflow">if</span> (empty($format) ) $format = <a class="code" href="group__publicPGTStorage.html#ga5">CAS_PGT_STORAGE_FILE_DEFAULT_FORMAT</a>;
00114       <span class="keywordflow">if</span> (empty($path) ) $path = <a class="code" href="group__publicPGTStorage.html#ga2">CAS_PGT_STORAGE_FILE_DEFAULT_PATH</a>;
00115 
00116       <span class="comment">// check that the path is an absolute path</span>
00117       <span class="keywordflow">if</span> (getenv(<span class="stringliteral">"OS"</span>)==<span class="stringliteral">"Windows_NT"</span>){
00118         
00119          <span class="keywordflow">if</span> (!preg_match('`^[a-zA-Z]:`', $path)) {
00120                 <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('an absolute path is needed <span class="keywordflow">for</span> PGT storage to file');
00121         }
00122         
00123       }
00124       <span class="keywordflow">else</span>
00125       {
00126       
00127         <span class="keywordflow">if</span> ( $path[0] != <span class="charliteral">'/'</span> ) {
00128                         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('an absolute path is needed <span class="keywordflow">for</span> PGT storage to file');
00129         }
00130 
00131         <span class="comment">// store the path (with a leading and trailing '/')      </span>
00132         $path = preg_replace('|[/]*$|<span class="charliteral">','</span>/',$path);
00133         $path = preg_replace('|^[/]*|<span class="charliteral">','</span>/',$path);
00134       }
00135       
00136       $this-&gt;_path = $path;
00137       <span class="comment">// check the format and store it</span>
00138       <span class="keywordflow">switch</span> ($format) {
00139       <span class="keywordflow">case</span> <a class="code" href="group__publicPGTStorage.html#ga3">CAS_PGT_STORAGE_FILE_FORMAT_PLAIN</a>:
00140       <span class="keywordflow">case</span> <a class="code" href="group__publicPGTStorage.html#ga4">CAS_PGT_STORAGE_FILE_FORMAT_XML</a>:
00141         $this-&gt;_format = $format;
00142         <span class="keywordflow">break</span>;
00143       <span class="keywordflow">default</span>:
00144         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('unknown PGT file storage format (`'.<a class="code" href="group__publicPGTStorage.html#ga3">CAS_PGT_STORAGE_FILE_FORMAT_PLAIN</a>.<span class="charliteral">'\'</span> and `'.CAS_PGT_STORAGE_FILE_FORMAT_XML.<span class="charliteral">'\'</span> allowed)');
00145       }
00146       <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();      
00147     }
00148 
00149   <span class="comment">// ########################################################################</span>
00150   <span class="comment">//  INITIALIZATION</span>
00151   <span class="comment">// ########################################################################</span>
00152   
<a name="l00158"></a><a class="code" href="group__internalPGTStorageFile.html#ga7">00158</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga7">init</a>()
00159     {
00160       <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00161       <span class="comment">// if the storage has already been initialized, return immediatly</span>
00162       <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="group__internalPGTStorage.html#ga18">isInitialized</a>() )
00163         <span class="keywordflow">return</span>;
00164       <span class="comment">// call the ancestor's method (mark as initialized)</span>
00165       parent::init();
00166       <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();      
00167     }
00168 
00169   <span class="comment">// ########################################################################</span>
00170   <span class="comment">//  PGT I/O</span>
00171   <span class="comment">// ########################################################################</span>
00172 
<a name="l00181"></a><a class="code" href="group__internalPGTStorageFile.html#ga8">00181</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga8">getPGTIouFilename</a>($pgt_iou)
00182     {
00183       <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00184       $filename = $this-&gt;<a class="code" href="group__internalPGTStorageFile.html#ga2">getPath</a>().$pgt_iou.<span class="charliteral">'.'</span>.$this-&gt;<a class="code" href="group__internalPGTStorageFile.html#ga3">getFormat</a>();
00185       <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>($filename);
00186       <span class="keywordflow">return</span> $filename;
00187     }
00188   
<a name="l00198"></a><a class="code" href="group__internalPGTStorageFile.html#ga9">00198</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga9">write</a>($pgt,$pgt_iou)
00199     {
00200       <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00201       $fname = $this-&gt;<a class="code" href="group__internalPGTStorageFile.html#ga8">getPGTIouFilename</a>($pgt_iou);
00202       <span class="keywordflow">if</span> ( $f=fopen($fname,<span class="stringliteral">"w"</span>) ) {
00203         <span class="keywordflow">if</span> ( fputs($f,$pgt) === FALSE ) {
00204           <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('could not write PGT to `'.$fname.<span class="charliteral">'\''</span>);
00205         }
00206         fclose($f);
00207       } <span class="keywordflow">else</span> {
00208         <a class="code" href="group__internalDebug.html#ga2">phpCAS::error</a>('could not open `'.$fname.<span class="charliteral">'\''</span>);
00209       }
00210       <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>();      
00211     }
00212 
<a name="l00223"></a><a class="code" href="group__internalPGTStorageFile.html#ga10">00223</a>   function <a class="code" href="group__internalPGTStorageFile.html#ga10">read</a>($pgt_iou)
00224     {
00225       <a class="code" href="group__internalDebug.html#ga4">phpCAS::traceBegin</a>();
00226       $pgt = FALSE;
00227       $fname = $this-&gt;<a class="code" href="group__internalPGTStorageFile.html#ga8">getPGTIouFilename</a>($pgt_iou);
00228       <span class="keywordflow">if</span> ( !($f=fopen($fname,<span class="stringliteral">"r"</span>)) ) {
00229         <a class="code" href="group__internalDebug.html#ga3">phpCAS::trace</a>('could not open `'.$fname.<span class="charliteral">'\''</span>);
00230       } <span class="keywordflow">else</span> {
00231         <span class="keywordflow">if</span> ( ($pgt=fgets($f)) === FALSE ) {
00232           <a class="code" href="group__internalDebug.html#ga3">phpCAS::trace</a>('could not read PGT from `'.$fname.<span class="charliteral">'\''</span>);
00233         } 
00234         fclose($f);
00235       }
00236 
00237       <span class="comment">// delete the PGT file</span>
00238       @unlink($fname);
00239 
00240       <a class="code" href="group__internalDebug.html#ga5">phpCAS::traceEnd</a>($pgt);
00241       <span class="keywordflow">return</span> $pgt;
00242     }
00243   
00246 }
00247 
00248   
00249 ?&gt;
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Fri May 2 11:03:57 2008 for phpCAS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.6 </small></address>
</body>
</html>
